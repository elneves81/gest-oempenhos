{% extends "base.html" %}
{% block title %}Contratos{% endblock %}
{% block page_title %}Contratos{% endblock %}

{% block page_actions %}
  <a href="{{ url_for('ui_contr.contr_new') }}" class="btn btn-outline-primary btn-sm">
    <i class="bi bi-plus-lg me-1"></i>Novo
  </a>
  <a href="{{ url_for('relatorios.rel_contratos') }}" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-printer me-1"></i>Imprimir
  </a>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>NÃºmero</th><th>Fornecedor</th><th>Status</th>
          <th class="text-end">Valor Atualizado</th>
          <th class="text-end">Empenhado</th>
          <th class="text-end">Saldo</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% for c in contratos %}
        <tr>
          <td>{{ c.numero }}</td>
          <td>{{ c.fornecedor }}</td>
          <td>
            <span class="badge bg-{{ 'success' if c.status == 'VIGENTE' else 'secondary' }}">
              {{ c.status }}
            </span>
          </td>
          <td class="text-end">R$ {{ '{:,.2f}'.format(c.valor_atualizado or 0).replace(',', 'X').replace('.', ',').replace('X','.') }}</td>
          <td class="text-end">R$ {{ '{:,.2f}'.format(c.empenhado_contrato or 0).replace(',', 'X').replace('.', ',').replace('X','.') }}</td>
          <td class="text-end">R$ {{ '{:,.2f}'.format(c.saldo_contrato).replace(',', 'X').replace('.', ',').replace('X','.') }}</td>
          <td class="text-end">
            <div class="btn-group btn-group-sm">
              <a href="{{ url_for('ui_contr.contr_edit', cid=c.id) }}" class="btn btn-outline-secondary" title="Editar">
                <i class="bi bi-pencil"></i>
              </a>
              <a href="{{ url_for('ui_contr.contr_empenhar', cid=c.id) }}" class="btn btn-outline-primary" title="Empenhar">
                <i class="bi bi-cash-coin"></i>
              </a>
              <a href="{{ url_for('ui_contr.contr_aditivo', cid=c.id) }}" class="btn btn-outline-success" title="Aditivo">
                <i class="bi bi-plus-circle"></i>
              </a>
            </div>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="7" class="text-center text-muted py-4">Nenhum contrato cadastrado.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if contratos %}
<div class="mt-3">
  <small class="text-muted">
    Total de {{ contratos|length }} contrato(s) |
    Valor total: R$ {{ '{:,.2f}'.format(contratos|sum(attribute='valor_atualizado')|float).replace(',', 'X').replace('.', ',').replace('X','.') }}
  </small>
</div>
{% endif %}
{% endblock %}
