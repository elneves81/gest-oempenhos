<!DOCTYPE html>
<html>
<head>
    <title>Teste de Fallback GridStack</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Sistema de Fallback GridStack</h1>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
            console.log(message);
        }
        
        // Carrega um script com timeout e melhor tratamento de erros
        function loadScript(src, onload, onerror, timeout = 5000) {
            addLog(`üîÑ Tentando carregar: ${src}`);
            
            const script = document.createElement('script');
            let isComplete = false;
            
            const cleanup = () => {
                if (!isComplete) {
                    isComplete = true;
                    clearTimeout(timer);
                    script.onload = script.onerror = null;
                }
            };
            
            const timer = setTimeout(() => {
                cleanup();
                addLog(`‚è∞ Timeout ao carregar: ${src}`, 'error');
                if (onerror) onerror(new Error('Timeout'));
            }, timeout);
            
            script.onload = () => {
                cleanup();
                addLog(`‚úÖ Carregado com sucesso: ${src}`, 'success');
                if (onload) onload();
            };
            
            script.onerror = (error) => {
                cleanup();
                addLog(`‚ùå Erro ao carregar: ${src}`, 'error');
                if (onerror) onerror(error);
            };
            
            script.src = src;
            script.async = true;
            document.head.appendChild(script);
        }
        
        // Fallback b√°sico quando todos os CDNs falham
        function createBasicFallback() {
            addLog('üîß Iniciando modo b√°sico sem GridStack...', 'warning');
            
            // Simula o comportamento b√°sico do GridStack
            window.GridStack = {
                init: () => ({
                    addWidget: () => addLog('üì¶ Widget adicionado (modo b√°sico)', 'success'),
                    removeWidget: () => addLog('üóëÔ∏è Widget removido (modo b√°sico)', 'success'),
                    removeAll: () => addLog('üßπ Todos widgets removidos (modo b√°sico)', 'success'),
                    enableMove: () => {},
                    enableResize: () => {},
                    save: () => [],
                    load: () => {},
                    update: () => {},
                    on: () => {}
                })
            };
            
            addLog('‚úÖ Sistema b√°sico configurado com sucesso!', 'success');
        }
        
        // Inicia teste
        addLog('üöÄ Iniciando teste de sistema de fallback...');
        
        // Sistema de carregamento com m√∫ltiplos fallbacks
        if (window.GridStack) {
            addLog('‚úÖ GridStack j√° carregado', 'success');
        } else {
            addLog('üîÑ GridStack n√£o encontrado, iniciando carregamento...');
            
            // Tentativa 1: jsdelivr.net
            loadScript(
                'https://cdn.jsdelivr.net/npm/gridstack@9.2.2/dist/gridstack-h5.js',
                () => {
                    addLog('‚úÖ GridStack carregado via jsdelivr', 'success');
                },
                () => {
                    addLog('‚ö†Ô∏è Fallback 1: jsdelivr falhou, tentando unpkg...', 'warning');
                    
                    // Tentativa 2: unpkg.com
                    loadScript(
                        'https://unpkg.com/gridstack@9.2.2/dist/gridstack-h5.js',
                        () => {
                            addLog('‚úÖ GridStack carregado via unpkg', 'success');
                        },
                        () => {
                            addLog('‚ö†Ô∏è Fallback 2: unpkg falhou, tentando cdnjs...', 'warning');
                            
                            // Tentativa 3: cdnjs.cloudflare.com
                            loadScript(
                                'https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/9.2.2/gridstack-h5.min.js',
                                () => {
                                    addLog('‚úÖ GridStack carregado via cdnjs', 'success');
                                },
                                () => {
                                    addLog('‚ùå Todos os CDNs falharam. Criando fallback b√°sico...', 'error');
                                    createBasicFallback();
                                }
                            );
                        }
                    );
                }
            );
        }
    </script>
</body>
</html>
