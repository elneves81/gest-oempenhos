/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/gridstack@9.2.2/dist/gridstack.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
 * GridStack 9.2.2
 * https://gridstackjs.com/
 *
 * Copyright (c) 2021-2022 Alain Dumesny
 * see root license https://github.com/gridstack/gridstack.js/tree/master/LICENSE
 */
import{GridStackEngine}from"./gridstack-engine";import{Utils,obsolete}from"./utils";import{gridDefaults,dragInDefaultOptions}from"./types";import{DDGridStack}from"./dd-gridstack";import{isTouch}from"./dd-touch";import{DDManager}from"./dd-manager";const dd=new DDGridStack;export*from"./types";export*from"./utils";export*from"./gridstack-engine";export*from"./dd-gridstack";class GridStack{static init(t={},e=".grid-stack"){let i=GridStack.getGridElement(e);return i?(i.gridstack||(i.gridstack=new GridStack(i,Utils.cloneDeep(t))),i.gridstack):("string"==typeof e?console.error('GridStack.initAll() no grid was found with selector "'+e+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.'):console.error("GridStack.init() no grid element was passed."),null)}static initAll(t={},e=".grid-stack"){let i=[];return GridStack.getGridElements(e).forEach((e=>{e.gridstack||(e.gridstack=new GridStack(e,Utils.cloneDeep(t))),i.push(e.gridstack)})),0===i.length&&console.error('GridStack.initAll() no grid was found with selector "'+e+'" - element missing or wrong selector ?\nNote: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.'),i}static addGrid(t,e={}){if(!t)return null;let i=t;if(i.gridstack){const t=i.gridstack;return e&&(t.opts={...t.opts,...e}),void 0!==e.children&&t.load(e.children),t}if(!t.classList.contains("grid-stack")||GridStack.addRemoveCB)if(GridStack.addRemoveCB)i=GridStack.addRemoveCB(t,e,!0,!0);else{let s=document.implementation.createHTMLDocument("");s.body.innerHTML=`<div class="grid-stack ${e.class||""}"></div>`,i=s.body.children[0],t.appendChild(i)}return GridStack.init(e,i)}static registerEngine(t){GridStack.engineClass=t}get placeholder(){if(!this._placeholder){let t=document.createElement("div");t.className="placeholder-content",this.opts.placeholderText&&(t.innerHTML=this.opts.placeholderText),this._placeholder=document.createElement("div"),this._placeholder.classList.add(this.opts.placeholderClass,gridDefaults.itemClass,this.opts.itemClass),this.placeholder.appendChild(t)}return this._placeholder}constructor(t,e={}){this._gsEventHandler={},this._extraDragRow=0,this.el=t,e=e||{},t.classList.contains("grid-stack")||this.el.classList.add("grid-stack"),e.row&&(e.minRow=e.maxRow=e.row,delete e.row);let i=Utils.toNumber(t.getAttribute("gs-row"));"auto"===e.column&&delete e.column,void 0!==e.alwaysShowResizeHandle&&(e._alwaysShowResizeHandle=e.alwaysShowResizeHandle);let s={...Utils.cloneDeep(gridDefaults),column:Utils.toNumber(t.getAttribute("gs-column"))||gridDefaults.column,minRow:i||(Utils.toNumber(t.getAttribute("gs-min-row"))||gridDefaults.minRow),maxRow:i||(Utils.toNumber(t.getAttribute("gs-max-row"))||gridDefaults.maxRow),staticGrid:Utils.toBool(t.getAttribute("gs-static"))||gridDefaults.staticGrid,draggable:{handle:(e.handleClass?"."+e.handleClass:e.handle?e.handle:"")||gridDefaults.draggable.handle},removableOptions:{accept:e.itemClass||gridDefaults.removableOptions.accept,decline:gridDefaults.removableOptions.decline}};t.getAttribute("gs-animate")&&(s.animate=Utils.toBool(t.getAttribute("gs-animate"))),this.opts=Utils.defaults(e,s),e=null,this._initMargin(),1!==this.opts.column&&!this.opts.disableOneColumnMode&&this._widthOrContainer()<=this.opts.oneColumnSize&&(this._prevColumn=this.getColumn(),this.opts.column=1),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===t.style.direction),this.opts.rtl&&this.el.classList.add("grid-stack-rtl");const r=this.el.parentElement?.parentElement;let o=r?.classList.contains(gridDefaults.itemClass)?r.gridstackNode:void 0;o&&(o.subGrid=this,this.parentGridItem=o,this.el.classList.add("grid-stack-nested"),o.el.classList.add("grid-stack-sub-grid")),this._isAutoCellHeight="auto"===this.opts.cellHeight,this._isAutoCellHeight||"initial"===this.opts.cellHeight?this.cellHeight(void 0,!1):("number"==typeof this.opts.cellHeight&&this.opts.cellHeightUnit&&this.opts.cellHeightUnit!==gridDefaults.cellHeightUnit&&(this.opts.cellHeight=this.opts.cellHeight+this.opts.cellHeightUnit,delete this.opts.cellHeightUnit),this.cellHeight(this.opts.cellHeight,!1)),"mobile"===this.opts.alwaysShowResizeHandle&&(this.opts.alwaysShowResizeHandle=isTouch),this._styleSheetClass="gs-id-"+GridStackEngine._idSeq++,this.el.classList.add(this._styleSheetClass),this._setStaticClass();let n=this.opts.engineClass||GridStack.engineClass||GridStackEngine;if(this.engine=new n({column:this.getColumn(),float:this.opts.float,maxRow:this.opts.maxRow,onChange:t=>{let e=0;this.engine.nodes.forEach((t=>{e=Math.max(e,t.y+t.h)})),t.forEach((t=>{let e=t.el;e&&(t._removeDOM?(e&&e.remove(),delete t._removeDOM):this._writePosAttr(e,t))})),this._updateStyles(!1,e)}}),this.opts.auto&&(this.batchUpdate(),this.getGridItems().forEach((t=>this._prepareElement(t))),this.batchUpdate(!1)),this.opts.children){let t=this.opts.children;delete this.opts.children,t.length&&this.load(t)}this.setAnimation(this.opts.animate),this._updateStyles(),this.el.classList.add("gs-"+this.opts.column),this.opts.subGridDynamic&&!DDManager.pauseDrag&&(DDManager.pauseDrag=!0),void 0!==this.opts.draggable?.pause&&(DDManager.pauseDrag=this.opts.draggable.pause),this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateResizeEvent()}addWidget(t,e){let i,s;if("string"==typeof t){let e=document.implementation.createHTMLDocument("");e.body.innerHTML=t,i=e.body.children[0]}else if(0===arguments.length||1===arguments.length&&(void 0!==(r=t).el||void 0!==r.x||void 0!==r.y||void 0!==r.w||void 0!==r.h||void 0!==r.content))if(s=e=t,s?.el)i=s.el;else if(GridStack.addRemoveCB)i=GridStack.addRemoveCB(this.el,e,!0,!1);else{let t=e?.content||"",s=document.implementation.createHTMLDocument("");s.body.innerHTML=`<div class="grid-stack-item ${this.opts.itemClass||""}"><div class="grid-stack-item-content">${t}</div></div>`,i=s.body.children[0]}else i=t;var r;if(!i)return;if(s=i.gridstackNode,s&&i.parentElement===this.el&&this.engine.nodes.find((t=>t._id===s._id)))return i;let o=this._readAttr(i);return e=Utils.cloneDeep(e)||{},Utils.defaults(e,o),s=this.engine.prepareNode(e),this._writeAttr(i,e),this._insertNotAppend?this.el.prepend(i):this.el.appendChild(i),this.makeWidget(i,e),i}makeSubGrid(t,e,i,s=!0){let r,o=t.gridstackNode;if(o||(o=this.makeWidget(t).gridstackNode),o.subGrid?.el)return o.subGrid;let n,l=this;for(;l&&!r;)r=l.opts?.subGridOpts,l=l.parentGridItem?.grid;e=Utils.cloneDeep({...r||{},children:void 0,...e||o.subGridOpts}),o.subGridOpts=e,"auto"===e.column&&(n=!0,e.column=Math.max(o.w||1,i?.w||1),e.disableOneColumnMode=!0);let d,a,h=o.el.querySelector(".grid-stack-item-content");if(s){if(this._removeDD(o.el),a={...o,x:0,y:0},Utils.removeInternalForSave(a),delete a.subGridOpts,o.content&&(a.content=o.content,delete o.content),GridStack.addRemoveCB)d=GridStack.addRemoveCB(this.el,a,!0,!1);else{let t=document.implementation.createHTMLDocument("");t.body.innerHTML='<div class="grid-stack-item"></div>',d=t.body.children[0],d.appendChild(h),t.body.innerHTML='<div class="grid-stack-item-content"></div>',h=t.body.children[0],o.el.appendChild(h)}this._prepareDragDropByNode(o)}if(i){let t=n?e.column:o.w,s=o.h+i.h,r=o.el.style;r.transition="none",this.update(o.el,{w:t,h:s}),setTimeout((()=>r.transition=null))}let g=o.subGrid=GridStack.addGrid(h,e);return i?._moving&&(g._isTemp=!0),n&&(g._autoColumn=!0),s&&g.addWidget(d,a),i&&(i._moving?window.setTimeout((()=>Utils.simulateMouseEvent(i._event,"mouseenter",g.el)),0):g.addWidget(o.el,o)),g}removeAsSubGrid(t){let e=this.parentGridItem?.grid;e&&(e.batchUpdate(),e.removeWidget(this.parentGridItem.el,!0,!0),this.engine.nodes.forEach((t=>{t.x+=this.parentGridItem.x,t.y+=this.parentGridItem.y,e.addWidget(t.el,t)})),e.batchUpdate(!1),this.parentGridItem&&delete this.parentGridItem.subGrid,delete this.parentGridItem,t&&window.setTimeout((()=>Utils.simulateMouseEvent(t._event,"mouseenter",e.el)),0))}save(t=!0,e=!1,i=GridStack.saveCB){let s=this.engine.save(t,i);if(s.forEach((s=>{if(t&&s.el&&!s.subGrid&&!i){let t=s.el.querySelector(".grid-stack-item-content");s.content=t?t.innerHTML:void 0,s.content||delete s.content}else if(t||i||delete s.content,s.subGrid?.el){const r=s.subGrid.save(t,e,i);s.subGridOpts=e?r:{children:r},delete s.subGrid}delete s.el})),e){let t=Utils.cloneDeep(this.opts);t.marginBottom===t.marginTop&&t.marginRight===t.marginLeft&&t.marginTop===t.marginRight&&(t.margin=t.marginTop,delete t.marginTop,delete t.marginRight,delete t.marginBottom,delete t.marginLeft),t.rtl===("rtl"===this.el.style.direction)&&(t.rtl="auto"),this._isAutoCellHeight&&(t.cellHeight="auto"),this._autoColumn&&(t.column="auto",delete t.disableOneColumnMode);const e=t._alwaysShowResizeHandle;return delete t._alwaysShowResizeHandle,void 0!==e?t.alwaysShowResizeHandle=e:delete t.alwaysShowResizeHandle,Utils.removeInternalAndSame(t,gridDefaults),t.children=s,t}return s}load(t,e=GridStack.addRemoveCB||!0){const i=t.some((t=>void 0!==t.x||void 0!==t.y));let s=i?Utils.sort(t,-1,this._prevColumn||this.getColumn()):t;this._insertNotAppend=i,this._prevColumn&&this._prevColumn!==this.opts.column&&s.some((t=>(t.x||0)+t.w>this.opts.column))&&(this._ignoreLayoutsNodeChange=!0,this.engine.cacheLayout(s,this._prevColumn,!0));const r=GridStack.addRemoveCB;"function"==typeof e&&(GridStack.addRemoveCB=e);let o=[];if(this.batchUpdate(),e){[...this.engine.nodes].forEach((t=>{s.find((e=>t.id===e.id))||(GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,t,!1,!1),o.push(t),this.removeWidget(t.el,!0,!1))}))}let n=this.engine.nodes;return this.engine.nodes=[],s.forEach((t=>{let i=void 0!==t.id?n.find((e=>e.id===t.id)):void 0;if(i){if((t.autoPosition||void 0===t.x||void 0===t.y)&&(t.w=t.w||i.w,t.h=t.h||i.h,this.engine.findEmptyPosition(t)),this.engine.nodes.push(i),this.update(i.el,t),t.subGridOpts?.children){let e=i.el.querySelector(".grid-stack");e&&e.gridstack&&(e.gridstack.load(t.subGridOpts.children),this._insertNotAppend=!0)}}else e&&this.addWidget(t)})),this.engine.removedNodes=o,this.batchUpdate(!1),delete this._ignoreLayoutsNodeChange,delete this._insertNotAppend,r?GridStack.addRemoveCB=r:delete GridStack.addRemoveCB,this}batchUpdate(t=!0){return this.engine.batchUpdate(t),t||(this._updateContainerHeight(),this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()),this}getCellHeight(t=!1){if(this.opts.cellHeight&&"auto"!==this.opts.cellHeight&&(!t||!this.opts.cellHeightUnit||"px"===this.opts.cellHeightUnit))return this.opts.cellHeight;let e=this.el.querySelector("."+this.opts.itemClass);if(e){let t=Utils.toNumber(e.getAttribute("gs-h"))||1;return Math.round(e.offsetHeight/t)}let i=parseInt(this.el.getAttribute("gs-current-row"));return i?Math.round(this.el.getBoundingClientRect().height/i):this.opts.cellHeight}cellHeight(t,e=!0){if(e&&void 0!==t&&this._isAutoCellHeight!==("auto"===t)&&(this._isAutoCellHeight="auto"===t,this._updateResizeEvent()),"initial"!==t&&"auto"!==t||(t=void 0),void 0===t){let e=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom;t=this.cellWidth()+e}let i=Utils.parseHeight(t);return this.opts.cellHeightUnit===i.unit&&this.opts.cellHeight===i.h||(this.opts.cellHeightUnit=i.unit,this.opts.cellHeight=i.h,this.doContentResize(!1,!0),e&&this._updateStyles(!0)),this}cellWidth(){return this._widthOrContainer()/this.getColumn()}_widthOrContainer(){return this.el.clientWidth||this.el.parentElement.clientWidth||window.innerWidth}compact(t="compact",e=!0){return this.engine.compact(t,e),this._triggerChangeEvent(),this}column(t,e="moveScale"){if(!t||t<1||this.opts.column===t)return this;let i,s=this.getColumn();return 1===t?this._prevColumn=s:delete this._prevColumn,this.el.classList.remove("gs-"+s),this.el.classList.add("gs-"+t),this.opts.column=this.engine.column=t,1===t&&this.opts.oneColumnModeDomSort&&(i=[],this.getGridItems().forEach((t=>{t.gridstackNode&&i.push(t.gridstackNode)})),i.length||(i=void 0)),this.engine.columnChanged(s,t,i,e),this._isAutoCellHeight&&this.cellHeight(),this.doContentResize(),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,this}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter((t=>t.matches("."+this.opts.itemClass)&&!t.matches("."+this.opts.placeholderClass)))}destroy(t=!0){if(this.el)return this.offAll(),this._updateResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),t?this.el.parentNode.removeChild(this.el):(this.removeAll(t),this.el.classList.remove(this._styleSheetClass),this.el.removeAttribute("gs-current-row")),this._removeStylesheet(),this.parentGridItem&&delete this.parentGridItem.subGrid,delete this.parentGridItem,delete this.opts,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(t){return this.opts.float!==t&&(this.opts.float=this.engine.float=t,this._triggerChangeEvent()),this}getFloat(){return this.engine.float}getCellFromPixel(t,e=!1){let i,s=this.el.getBoundingClientRect();i=e?{top:s.top+document.documentElement.scrollTop,left:s.left}:{top:this.el.offsetTop,left:this.el.offsetLeft};let r=t.left-i.left,o=t.top-i.top,n=s.width/this.getColumn(),l=s.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(r/n),y:Math.floor(o/l)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow)}isAreaEmpty(t,e,i,s){return this.engine.isAreaEmpty(t,e,i,s)}makeWidget(t,e){let i=GridStack.getElement(t);this._prepareElement(i,!0,e);const s=i.gridstackNode;return this._updateContainerHeight(),this.doContentResize(!1,!1,s),s.subGridOpts&&this.makeSubGrid(i,s.subGridOpts,void 0,!1),this._prevColumn&&1===this.opts.column&&(this._ignoreLayoutsNodeChange=!0),this._triggerAddEvent(),this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,i}on(t,e){if(-1!==t.indexOf(" ")){return t.split(" ").forEach((t=>this.on(t,e))),this}if("change"===t||"added"===t||"removed"===t||"enable"===t||"disable"===t){let i="enable"===t||"disable"===t;this._gsEventHandler[t]=i?t=>e(t):t=>e(t,t.detail),this.el.addEventListener(t,this._gsEventHandler[t])}else"drag"===t||"dragstart"===t||"dragstop"===t||"resizestart"===t||"resize"===t||"resizestop"===t||"dropped"===t||"resizecontent"===t?this._gsEventHandler[t]=e:console.log("GridStack.on("+t+') event not supported, but you can still use $(".grid-stack").on(...) while jquery-ui is still used internally.');return this}off(t){if(-1!==t.indexOf(" ")){return t.split(" ").forEach((t=>this.off(t))),this}return"change"!==t&&"added"!==t&&"removed"!==t&&"enable"!==t&&"disable"!==t||this._gsEventHandler[t]&&this.el.removeEventListener(t,this._gsEventHandler[t]),delete this._gsEventHandler[t],this}offAll(){return Object.keys(this._gsEventHandler).forEach((t=>this.off(t))),this}removeWidget(t,e=!0,i=!0){return GridStack.getElements(t).forEach((t=>{if(t.parentElement&&t.parentElement!==this.el)return;let s=t.gridstackNode;s||(s=this.engine.nodes.find((e=>t===e.el))),s&&(GridStack.addRemoveCB&&GridStack.addRemoveCB(this.el,s,!1,!1),delete t.gridstackNode,this._removeDD(t),this.engine.removeNode(s,e,i),e&&t.parentElement&&t.remove())})),i&&(this._triggerRemoveEvent(),this._triggerChangeEvent()),this}removeAll(t=!0){return this.engine.nodes.forEach((t=>{delete t.el.gridstackNode,this._removeDD(t.el)})),this.engine.removeAll(t),this._triggerRemoveEvent(),this}setAnimation(t){return t?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this}setStatic(t,e=!0,i=!0){return!!this.opts.staticGrid===t||(t?this.opts.staticGrid=!0:delete this.opts.staticGrid,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach((s=>{this._prepareDragDropByNode(s),s.subGrid&&i&&s.subGrid.setStatic(t,e,i)})),e&&this._setStaticClass()),this}update(t,e){if(arguments.length>2){console.warn("gridstack.ts: `update(el, x, y, w, h)` is deprecated. Use `update(el, {x, w, content, ...})`. It will be removed soon");let i=arguments,s=1;return e={x:i[s++],y:i[s++],w:i[s++],h:i[s++]},this.update(t,e)}return GridStack.getElements(t).forEach((t=>{let i=t?.gridstackNode;if(!i)return;let s=Utils.cloneDeep(e);delete s.autoPosition;let r,o=["x","y","w","h"];if(o.some((t=>void 0!==s[t]&&s[t]!==i[t]))&&(r={},o.forEach((t=>{r[t]=void 0!==s[t]?s[t]:i[t],delete s[t]}))),!r&&(s.minW||s.minH||s.maxW||s.maxH)&&(r={}),void 0!==s.content){const e=t.querySelector(".grid-stack-item-content");if(!e||e.innerHTML===s.content)return;e.innerHTML=s.content,i.subGrid?.el&&(e.appendChild(i.subGrid.el),i.subGrid.opts.styleInHead||i.subGrid._updateStyles(!0)),delete s.content}let n=!1,l=!1;for(const t in s)"_"!==t[0]&&i[t]!==s[t]&&(i[t]=s[t],n=!0,l=l||!this.opts.staticGrid&&("noResize"===t||"noMove"===t||"locked"===t));Utils.sanitizeMinMax(i),r&&this.moveNode(i,r),n&&this._writeAttr(t,i),l&&this._prepareDragDropByNode(i)})),this}moveNode(t,e){this.engine.cleanNodes().beginUpdate(t).moveNode(t,e),this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()}resizeToContent(t,e=!1){if(!t)return;if(t.classList.remove("size-to-content-max"),!t.clientHeight)return;let i=t.gridstackNode;if(!i)return;const s=i.grid;if(!s)return;if(t.parentElement!==s.el)return;const r=s.getCellHeight();if(!r)return;let o,n=e&&i.h?i.h*r:t.clientHeight;if(i.resizeToContentParent&&(o=t.querySelector(i.resizeToContentParent)),o||(o=t.querySelector(GridStack.resizeToContentParent)),!o)return;const l=t.clientHeight-o.clientHeight,d=e&&i.h?i.h*r-l:o.clientHeight;let a;if(i.subGrid)a=i.subGrid.getRow()*i.subGrid.getCellHeight();else{const t=o.firstElementChild;if(!t)return void console.log(`Error: resizeToContent() '${GridStack.resizeToContentParent}'.firstElementChild is null, make sure to have a div like container. Skipping sizing.`);a=t.getBoundingClientRect().height||d}if(d===a)return;n+=a-d;let h=Math.ceil(n/r);const g=Number.isInteger(i.sizeToContent)?i.sizeToContent:0;g&&h>g&&(h=g,t.classList.add("size-to-content-max")),i.minH&&h<i.minH?h=i.minH:i.maxH&&h>i.maxH&&(h=i.maxH),h!==i.h&&(s._ignoreLayoutsNodeChange=!0,s.moveNode(i,{h:h}),delete s._ignoreLayoutsNodeChange)}resizeToContentCheck(t,e=!1){GridStack.resizeToContentCB?GridStack.resizeToContentCB(t,e):this.resizeToContent(t,e)}margin(t){if(!("string"==typeof t&&t.split(" ").length>1)){let e=Utils.parseHeight(t);if(this.opts.marginUnit===e.unit&&this.opts.margin===e.h)return}return this.opts.margin=t,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this._initMargin(),this._updateStyles(!0),this}getMargin(){return this.opts.margin}willItFit(t){if(arguments.length>1){console.warn("gridstack.ts: `willItFit(x,y,w,h,autoPosition)` is deprecated. Use `willItFit({x, y,...})`. It will be removed soon");let t=arguments,e=0,i={x:t[e++],y:t[e++],w:t[e++],h:t[e++],autoPosition:t[e++]};return this.willItFit(i)}return this.engine.willItFit(t)}_triggerChangeEvent(){if(this.engine.batchMode)return this;let t=this.engine.getDirtyNodes(!0);return t&&t.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(t),this._triggerEvent("change",t)),this.engine.saveInitial(),this}_triggerAddEvent(){return this.engine.batchMode||this.engine.addedNodes?.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach((t=>{delete t._dirty})),this._triggerEvent("added",this.engine.addedNodes),this.engine.addedNodes=[]),this}_triggerRemoveEvent(){return this.engine.batchMode||this.engine.removedNodes?.length&&(this._triggerEvent("removed",this.engine.removedNodes),this.engine.removedNodes=[]),this}_triggerEvent(t,e){let i=e?new CustomEvent(t,{bubbles:!1,detail:e}):new Event(t);return this.el.dispatchEvent(i),this}_removeStylesheet(){return this._styles&&(Utils.removeStylesheet(this._styleSheetClass),delete this._styles),this}_updateStyles(t=!1,e){if(t&&this._removeStylesheet(),e||(e=this.getRow()),this._updateContainerHeight(),0===this.opts.cellHeight)return this;let i=this.opts.cellHeight,s=this.opts.cellHeightUnit,r=`.${this._styleSheetClass} > .${this.opts.itemClass}`;if(!this._styles){let t=this.opts.styleInHead?void 0:this.el.parentNode;if(this._styles=Utils.createStylesheet(this._styleSheetClass,t,{nonce:this.opts.nonce}),!this._styles)return this;this._styles._max=0,Utils.addCSSRule(this._styles,r,`height: ${i}${s}`);let e=this.opts.marginTop+this.opts.marginUnit,o=this.opts.marginBottom+this.opts.marginUnit,n=this.opts.marginRight+this.opts.marginUnit,l=this.opts.marginLeft+this.opts.marginUnit,d=`${r} > .grid-stack-item-content`,a=`.${this._styleSheetClass} > .grid-stack-placeholder > .placeholder-content`;Utils.addCSSRule(this._styles,d,`top: ${e}; right: ${n}; bottom: ${o}; left: ${l};`),Utils.addCSSRule(this._styles,a,`top: ${e}; right: ${n}; bottom: ${o}; left: ${l};`),Utils.addCSSRule(this._styles,`${r} > .ui-resizable-ne`,`right: ${n}`),Utils.addCSSRule(this._styles,`${r} > .ui-resizable-e`,`right: ${n}`),Utils.addCSSRule(this._styles,`${r} > .ui-resizable-se`,`right: ${n}; bottom: ${o}`),Utils.addCSSRule(this._styles,`${r} > .ui-resizable-nw`,`left: ${l}`),Utils.addCSSRule(this._styles,`${r} > .ui-resizable-w`,`left: ${l}`),Utils.addCSSRule(this._styles,`${r} > .ui-resizable-sw`,`left: ${l}; bottom: ${o}`)}if((e=e||this._styles._max)>this._styles._max){let t=t=>i*t+s;for(let i=this._styles._max+1;i<=e;i++)Utils.addCSSRule(this._styles,`${r}[gs-y="${i}"]`,`top: ${t(i)}`),Utils.addCSSRule(this._styles,`${r}[gs-h="${i+1}"]`,`height: ${t(i+1)}`);this._styles._max=e}return this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;const t=this.parentGridItem;let e=this.getRow()+this._extraDragRow;const i=this.opts.cellHeight,s=this.opts.cellHeightUnit;if(!i)return this;if(!t){const t=Utils.parseHeight(getComputedStyle(this.el).minHeight);if(t.h>0&&t.unit===s){const s=Math.floor(t.h/i);e<s&&(e=s)}}return this.el.setAttribute("gs-current-row",String(e)),this.el.style.removeProperty("min-height"),this.el.style.removeProperty("height"),e&&(this.el.style[t?"minHeight":"height"]=e*i+s),t&&!t.grid.engine.batchMode&&Utils.shouldSizeToContent(t)&&t.grid.resizeToContentCheck(t.el),this}_prepareElement(t,e=!1,i){t.classList.add(this.opts.itemClass),i=i||this._readAttr(t),t.gridstackNode=i,i.el=t,i.grid=this;let s={...i};return i=this.engine.addNode(i,e),Utils.same(i,s)||this._writeAttr(t,i),Utils.shouldSizeToContent(i)&&t.classList.add("size-to-content"),this._prepareDragDropByNode(i),this}_writePosAttr(t,e){return void 0!==e.x&&null!==e.x&&t.setAttribute("gs-x",String(e.x)),void 0!==e.y&&null!==e.y&&t.setAttribute("gs-y",String(e.y)),e.w>1?t.setAttribute("gs-w",String(e.w)):t.removeAttribute("gs-w"),e.h>1?t.setAttribute("gs-h",String(e.h)):t.removeAttribute("gs-h"),this}_writeAttr(t,e){if(!e)return this;this._writePosAttr(t,e);let i={autoPosition:"gs-auto-position",noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id"};for(const s in i)e[s]?t.setAttribute(i[s],String(e[s])):t.removeAttribute(i[s]);return this}_readAttr(t,e=!0){let i={};i.x=Utils.toNumber(t.getAttribute("gs-x")),i.y=Utils.toNumber(t.getAttribute("gs-y")),i.w=Utils.toNumber(t.getAttribute("gs-w")),i.h=Utils.toNumber(t.getAttribute("gs-h")),i.autoPosition=Utils.toBool(t.getAttribute("gs-auto-position")),i.noResize=Utils.toBool(t.getAttribute("gs-no-resize")),i.noMove=Utils.toBool(t.getAttribute("gs-no-move")),i.locked=Utils.toBool(t.getAttribute("gs-locked")),i.id=t.getAttribute("gs-id"),i.maxW=Utils.toNumber(t.getAttribute("gs-max-w")),i.minW=Utils.toNumber(t.getAttribute("gs-min-w")),i.maxH=Utils.toNumber(t.getAttribute("gs-max-h")),i.minH=Utils.toNumber(t.getAttribute("gs-min-h")),e&&(1===i.w&&t.removeAttribute("gs-w"),1===i.h&&t.removeAttribute("gs-h"),i.maxW&&t.removeAttribute("gs-max-w"),i.minW&&t.removeAttribute("gs-min-w"),i.maxH&&t.removeAttribute("gs-max-h"),i.minH&&t.removeAttribute("gs-min-h"));for(const t in i){if(!i.hasOwnProperty(t))return;i[t]||0===i[t]||delete i[t]}return i}_setStaticClass(){let t=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...t),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...t),this.el.removeAttribute("gs-static")),this}onResize(){if(!this.el?.clientWidth)return;if(this.prevWidth===this.el.clientWidth)return;this.prevWidth=this.el.clientWidth,this.batchUpdate();let t=!1;if(this._autoColumn&&this.parentGridItem)this.opts.column!==this.parentGridItem.w&&(this.column(this.parentGridItem.w,"none"),t=!0);else{let e=!this.opts.disableOneColumnMode&&this.el.clientWidth<=this.opts.oneColumnSize||1===this.opts.column&&!this._prevColumn;1===this.opts.column!==e&&(this.column(e?1:this._prevColumn),t=!0)}return this._isAutoCellHeight&&this.cellHeight(),this.engine.nodes.forEach((t=>{t.subGrid&&t.subGrid.onResize()})),this._skipInitialResize||this.doContentResize(t),delete this._skipInitialResize,this.batchUpdate(!1),this}doContentResize(t=!0,e=!1,i=void 0){setTimeout((()=>{if(i)Utils.shouldSizeToContent(i)&&this.resizeToContentCheck(i.el,e);else if(this.engine.nodes.some((t=>Utils.shouldSizeToContent(t)))){const t=[...this.engine.nodes];this.batchUpdate(),t.forEach((t=>{Utils.shouldSizeToContent(t)&&this.resizeToContentCheck(t.el,e)})),this.batchUpdate(!1)}this._gsEventHandler.resizecontent&&this._gsEventHandler.resizecontent(null,i?[i]:this.engine.nodes)}),t?310:0)}_updateResizeEvent(t=!1){const e=!this.parentGridItem&&(this._isAutoCellHeight||this.opts.sizeToContent||!this.opts.disableOneColumnMode||this.engine.nodes.find((t=>t.sizeToContent)));return t||!e||this.resizeObserver?!t&&e||!this.resizeObserver||(this.resizeObserver.disconnect(),delete this.resizeObserver,delete this._sizeThrottle):(this._sizeThrottle=Utils.throttle((()=>this.onResize()),this.opts.cellHeightThrottle),this.resizeObserver=new ResizeObserver((t=>this._sizeThrottle())),this.resizeObserver.observe(this.el),this._skipInitialResize=!0),this}static getElement(t=".grid-stack-item"){return Utils.getElement(t)}static getElements(t=".grid-stack-item"){return Utils.getElements(t)}static getGridElement(t){return GridStack.getElement(t)}static getGridElements(t){return Utils.getElements(t)}_initMargin(){let t,e=0,i=[];return"string"==typeof this.opts.margin&&(i=this.opts.margin.split(" ")),2===i.length?(this.opts.marginTop=this.opts.marginBottom=i[0],this.opts.marginLeft=this.opts.marginRight=i[1]):4===i.length?(this.opts.marginTop=i[0],this.opts.marginRight=i[1],this.opts.marginBottom=i[2],this.opts.marginLeft=i[3]):(t=Utils.parseHeight(this.opts.margin),this.opts.marginUnit=t.unit,e=this.opts.margin=t.h),void 0===this.opts.marginTop?this.opts.marginTop=e:(t=Utils.parseHeight(this.opts.marginTop),this.opts.marginTop=t.h,delete this.opts.margin),void 0===this.opts.marginBottom?this.opts.marginBottom=e:(t=Utils.parseHeight(this.opts.marginBottom),this.opts.marginBottom=t.h,delete this.opts.margin),void 0===this.opts.marginRight?this.opts.marginRight=e:(t=Utils.parseHeight(this.opts.marginRight),this.opts.marginRight=t.h,delete this.opts.margin),void 0===this.opts.marginLeft?this.opts.marginLeft=e:(t=Utils.parseHeight(this.opts.marginLeft),this.opts.marginLeft=t.h,delete this.opts.margin),this.opts.marginUnit=t.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop),this}static getDD(){return dd}static setupDragIn(t,e,i=document){void 0!==e?.pause&&(DDManager.pauseDrag=e.pause),e={...dragInDefaultOptions,...e||{}};let s="string"==typeof t?Utils.getElements(t,i):t;s.length&&s?.forEach((t=>{dd.isDraggable(t)||dd.dragIn(t,e)}))}movable(t,e){return this.opts.staticGrid||GridStack.getElements(t).forEach((t=>{let i=t.gridstackNode;i&&(e?delete i.noMove:i.noMove=!0,this._prepareDragDropByNode(i))})),this}resizable(t,e){return this.opts.staticGrid||GridStack.getElements(t).forEach((t=>{let i=t.gridstackNode;i&&(e?delete i.noResize:i.noResize=!0,this._prepareDragDropByNode(i))})),this}disable(t=!0){if(!this.opts.staticGrid)return this.enableMove(!1,t),this.enableResize(!1,t),this._triggerEvent("disable"),this}enable(t=!0){if(!this.opts.staticGrid)return this.enableMove(!0,t),this.enableResize(!0,t),this._triggerEvent("enable"),this}enableMove(t,e=!0){return this.opts.staticGrid||(t?delete this.opts.disableDrag:this.opts.disableDrag=!0,this.engine.nodes.forEach((i=>{this._prepareDragDropByNode(i),i.subGrid&&e&&i.subGrid.enableMove(t,e)}))),this}enableResize(t,e=!0){return this.opts.staticGrid||(t?delete this.opts.disableResize:this.opts.disableResize=!0,this.engine.nodes.forEach((i=>{this._prepareDragDropByNode(i),i.subGrid&&e&&i.subGrid.enableResize(t,e)}))),this}_removeDD(t){return dd.draggable(t,"destroy").resizable(t,"destroy"),t.gridstackNode&&delete t.gridstackNode._initDD,delete t.ddElement,this}_setupAcceptWidget(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return dd.droppable(this.el,"destroy"),this;let t,e,i=(i,s,r)=>{let o=s.gridstackNode;if(!o)return;r=r||s;let n=this.el.getBoundingClientRect(),{top:l,left:d}=r.getBoundingClientRect();d-=n.left,l-=n.top;let a={position:{top:l,left:d}};if(o._temporaryRemoved){if(o.x=Math.max(0,Math.round(d/e)),o.y=Math.max(0,Math.round(l/t)),delete o.autoPosition,this.engine.nodeBoundFix(o),!this.engine.willItFit(o)){if(o.autoPosition=!0,!this.engine.willItFit(o))return void dd.off(s,"drag");o._willFitPos&&(Utils.copyPos(o,o._willFitPos),delete o._willFitPos)}this._onStartMoving(r,i,a,o,e,t)}else this._dragOrResize(r,i,a,o,e,t)};return dd.droppable(this.el,{accept:t=>{let e=t.gridstackNode;if(e?.grid===this)return!0;if(!this.opts.acceptWidgets)return!1;let i=!0;if("function"==typeof this.opts.acceptWidgets)i=this.opts.acceptWidgets(t);else{let e=!0===this.opts.acceptWidgets?".grid-stack-item":this.opts.acceptWidgets;i=t.matches(e)}if(i&&e&&this.opts.maxRow){let t={w:e.w,h:e.h,minW:e.minW,minH:e.minH};i=this.engine.willItFit(t)}return i}}).on(this.el,"dropover",((s,r,o)=>{let n=r.gridstackNode;if(n?.grid===this&&!n._temporaryRemoved)return!1;if(n?.grid&&n.grid!==this&&!n._temporaryRemoved){n.grid._leave(r,o)}e=this.cellWidth(),t=this.getCellHeight(!0),n||(n=this._readAttr(r,!1)),n.grid||(n._isExternal=!0,r.gridstackNode=n),o=o||r;let l=n.w||Math.round(o.offsetWidth/e)||1,d=n.h||Math.round(o.offsetHeight/t)||1;return n.grid&&n.grid!==this?(r._gridstackNodeOrig||(r._gridstackNodeOrig=n),r.gridstackNode=n={...n,w:l,h:d,grid:this},delete n.x,delete n.y,this.engine.cleanupNode(n).nodeBoundFix(n),n._initDD=n._isExternal=n._temporaryRemoved=!0):(n.w=l,n.h=d,n._temporaryRemoved=!0),this._itemRemoving(n.el,!1),dd.on(r,"drag",i),i(s,r,o),!1})).on(this.el,"dropout",((t,e,i)=>{let s=e.gridstackNode;return!!s&&(s.grid&&s.grid!==this||(this._leave(e,i),this._isTemp&&this.removeAsSubGrid(s)),!1)})).on(this.el,"drop",((t,e,i)=>{let s=e.gridstackNode;if(s?.grid===this&&!s._isExternal)return!1;let r=!!this.placeholder.parentElement;this.placeholder.remove();let o=e._gridstackNodeOrig;if(delete e._gridstackNodeOrig,r&&o?.grid&&o.grid!==this){let t=o.grid;t.engine.removeNodeFromLayoutCache(o),t.engine.removedNodes.push(o),t._triggerRemoveEvent()._triggerChangeEvent(),t.parentGridItem&&!t.engine.nodes.length&&t.opts.subGridDynamic&&t.removeAsSubGrid()}if(!s)return!1;if(r&&(this.engine.cleanupNode(s),s.grid=this),dd.off(e,"drag"),i!==e?(i.remove(),e.gridstackNode=o,r&&(e=e.cloneNode(!0))):(e.remove(),this._removeDD(e)),!r)return!1;e.gridstackNode=s,s.el=e;let n=s.subGrid?.el?.gridstack;return Utils.copyPos(s,this._readAttr(this.placeholder)),Utils.removePositioningStyles(e),this._writeAttr(e,s),e.classList.add(gridDefaults.itemClass,this.opts.itemClass),this.el.appendChild(e),n&&(n.parentGridItem=s,n.opts.styleInHead||n._updateStyles(!0)),this._updateContainerHeight(),this.engine.addedNodes.push(s),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped({...t,type:"dropped"},o&&o.grid?o:void 0,s),window.setTimeout((()=>{s.el&&s.el.parentElement?this._prepareDragDropByNode(s):this.engine.removeNode(s),delete s.grid._isTemp})),!1})),this}_itemRemoving(t,e){let i=t?t.gridstackNode:void 0;i&&i.grid&&!t.classList.contains(this.opts.removableOptions.decline)&&(e?i._isAboutToRemove=!0:delete i._isAboutToRemove,e?t.classList.add("grid-stack-item-removing"):t.classList.remove("grid-stack-item-removing"))}_setupRemoveDrop(){if(!this.opts.staticGrid&&"string"==typeof this.opts.removable){let t=document.querySelector(this.opts.removable);if(!t)return this;dd.isDroppable(t)||dd.droppable(t,this.opts.removableOptions).on(t,"dropover",((t,e)=>this._itemRemoving(e,!0))).on(t,"dropout",((t,e)=>this._itemRemoving(e,!1)))}return this}_prepareDragDropByNode(t){let e=t.el;const i=t.noMove||this.opts.disableDrag,s=t.noResize||this.opts.disableResize;if(this.opts.staticGrid||i&&s)return t._initDD&&(this._removeDD(e),delete t._initDD),e.classList.add("ui-draggable-disabled","ui-resizable-disabled"),this;if(!t._initDD){let i,s,r=(r,o)=>{this._gsEventHandler[r.type]&&this._gsEventHandler[r.type](r,r.target),i=this.cellWidth(),s=this.getCellHeight(!0),this._onStartMoving(e,r,o,t,i,s)},o=(r,o)=>{this._dragOrResize(e,r,o,t,i,s)},n=i=>{this.placeholder.remove(),delete t._moving,delete t._event,delete t._lastTried;let s=i.target;if(s.gridstackNode&&s.gridstackNode.grid===this){if(t.el=s,t._isAboutToRemove){let r=e.gridstackNode.grid;r._gsEventHandler[i.type]&&r._gsEventHandler[i.type](i,s),r.engine.nodes.push(t),r.removeWidget(e,!0,!0)}else Utils.removePositioningStyles(s),t._temporaryRemoved?(Utils.copyPos(t,t._orig),this._writePosAttr(s,t),this.engine.addNode(t)):this._writePosAttr(s,t),this._gsEventHandler[i.type]&&this._gsEventHandler[i.type](i,s);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate(),"resizestop"===i.type&&(Number.isInteger(t.sizeToContent)&&(t.sizeToContent=t.h),this.doContentResize(!1,!0,t))}};dd.draggable(e,{start:r,stop:n,drag:o}).resizable(e,{start:r,stop:n,resize:o}),t._initDD=!0}return dd.draggable(e,i?"disable":"enable").resizable(e,s?"disable":"enable"),this}_onStartMoving(t,e,i,s,r,o){this.engine.cleanNodes().beginUpdate(s),this._writePosAttr(this.placeholder,s),this.el.appendChild(this.placeholder),s.el=this.placeholder,s._lastUiPosition=i.position,s._prevYPix=i.position.top,s._moving="dragstart"===e.type,delete s._lastTried,"dropover"===e.type&&s._temporaryRemoved&&(this.engine.addNode(s),s._moving=!0),this.engine.cacheRects(r,o,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),"resizestart"===e.type&&(dd.resizable(t,"option","minWidth",r*(s.minW||1)).resizable(t,"option","minHeight",o*(s.minH||1)),s.maxW&&dd.resizable(t,"option","maxWidth",r*s.maxW),s.maxH&&dd.resizable(t,"option","maxHeight",o*s.maxH))}_dragOrResize(t,e,i,s,r,o){let n,l={...s._orig},d=this.opts.marginLeft,a=this.opts.marginRight,h=this.opts.marginTop,g=this.opts.marginBottom,p=Math.round(.1*o),c=Math.round(.1*r);if(d=Math.min(d,c),a=Math.min(a,c),h=Math.min(h,p),g=Math.min(g,p),"drag"===e.type){if(s._temporaryRemoved)return;let e=i.position.top-s._prevYPix;s._prevYPix=i.position.top,!1!==this.opts.draggable.scroll&&Utils.updateScrollPosition(t,i.position,e);let n=i.position.left+(i.position.left>s._lastUiPosition.left?-a:d),p=i.position.top+(i.position.top>s._lastUiPosition.top?-g:h);l.x=Math.round(n/r),l.y=Math.round(p/o);let c=this._extraDragRow;if(this.engine.collide(s,l)){let t=this.getRow(),e=Math.max(0,l.y+s.h-t);this.opts.maxRow&&t+e>this.opts.maxRow&&(e=Math.max(0,this.opts.maxRow-t)),this._extraDragRow=e}else this._extraDragRow=0;if(this._extraDragRow!==c&&this._updateContainerHeight(),s.x===l.x&&s.y===l.y)return}else if("resize"===e.type){if(l.x<0)return;if(Utils.updateScrollResize(e,t,o),l.w=Math.round((i.size.width-d)/r),l.h=Math.round((i.size.height-h)/o),s.w===l.w&&s.h===l.h)return;if(s._lastTried&&s._lastTried.w===l.w&&s._lastTried.h===l.h)return;let a=i.position.left+d,g=i.position.top+h;l.x=Math.round(a/r),l.y=Math.round(g/o),n=!0}s._event=e,s._lastTried=l;let m={x:i.position.left+d,y:i.position.top+h,w:(i.size?i.size.width:s.w*r)-d-a,h:(i.size?i.size.height:s.h*o)-h-g};if(this.engine.moveNodeCheck(s,{...l,cellWidth:r,cellHeight:o,rect:m,resizing:n})){s._lastUiPosition=i.position,this.engine.cacheRects(r,o,h,a,g,d),delete s._skipDown,n&&s.subGrid&&s.subGrid.onResize(),this._extraDragRow=0,this._updateContainerHeight();let t=e.target;this._writePosAttr(t,s),this._gsEventHandler[e.type]&&this._gsEventHandler[e.type](e,t)}}_leave(t,e){let i=t.gridstackNode;i&&(dd.off(t,"drag"),i._temporaryRemoved||(i._temporaryRemoved=!0,this.engine.removeNode(i),i.el=i._isExternal&&e?e:t,!0===this.opts.removable&&this._itemRemoving(t,!0),t._gridstackNodeOrig?(t.gridstackNode=t._gridstackNodeOrig,delete t._gridstackNodeOrig):i._isExternal&&(delete i.el,delete t.gridstackNode,this.engine.restoreInitial())))}commit(){return obsolete(this,this.batchUpdate(!1),"commit","batchUpdate","5.2"),this}}GridStack.resizeToContentParent=".grid-stack-item-content",GridStack.Utils=Utils,GridStack.Engine=GridStackEngine,GridStack.GDRev="9.2.2";export{GridStack};
//# sourceMappingURL=/sm/20c9df0dd68e2184d6b258f226a7882377672254956eddf05f35055755dcd172.map